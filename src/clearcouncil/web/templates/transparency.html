{% extends "base.html" %}

{% block title %}Data Transparency – ClearCouncil{% endblock %}

{% block breadcrumb %}
<nav class="cc-breadcrumb" aria-label="Breadcrumb">
  <a href="{{ url_for('main.index') }}">Home</a>
  <span class="sep" aria-hidden="true">/</span>
  <span aria-current="page">Transparency</span>
</nav>
{% endblock %}

{% block content %}
<div class="cc-fade-in">

  <!-- ── Page header ───────────────────────────────────────────── -->
  <div class="cc-card mb-4">
    <div class="cc-card-body">
      <h1 style="font-size:1.75rem;margin-bottom:0.25rem;">
        <i class="fas fa-shield-alt text-primary me-2" aria-hidden="true"></i>
        Data Transparency
      </h1>
      <p class="text-muted mb-0" style="font-size:.92rem;">
        See exactly what data has been processed and where it comes from.
      </p>
    </div>
  </div>

  <!-- ── Per-council stats ──────────────────────────────────────── -->
  {% for council_id, data in council_data.items() %}
  <div class="cc-card mb-4 cc-stagger">
    <div class="cc-card-header">
      <i class="fas fa-building text-primary" aria-hidden="true"></i>
      <h2 style="font-size:1rem;margin:0;">{{ data.name }}</h2>
    </div>
    <div class="cc-card-body">
      {% if data.error %}
      <div style="padding:.75rem 1rem;background:#fee2e2;border-radius:var(--cc-radius-sm);border-left:3px solid var(--cc-danger);font-size:.9rem;">
        <i class="fas fa-exclamation-triangle me-2" aria-hidden="true"></i>
        Error loading data: {{ data.error }}
      </div>
      {% else %}
      <div class="row g-4 mb-4">
        <div class="col-md-6">
          <h4 style="font-size:.95rem;margin-bottom:.75rem;">
            <i class="fas fa-file-pdf text-primary me-1" aria-hidden="true"></i>Document Processing
          </h4>
          <div class="cc-table-wrapper">
            <table class="cc-table">
              <tbody>
                <tr><th>Total Documents</th><td>{{ data.doc_stats[0] }}</td></tr>
                <tr><th>Successfully Processed</th><td>{{ data.doc_stats[1] }}</td></tr>
                <tr><th>First Processed</th><td>{{ data.doc_stats[2] or 'N/A' }}</td></tr>
                <tr><th>Last Processed</th><td>{{ data.doc_stats[3] or 'N/A' }}</td></tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="col-md-6">
          <h4 style="font-size:.95rem;margin-bottom:.75rem;">
            <i class="fas fa-vote-yea text-success me-1" aria-hidden="true"></i>Voting Records
          </h4>
          <div class="cc-table-wrapper">
            <table class="cc-table">
              <tbody>
                <tr><th>Total Voting Records</th><td>{{ data.vote_stats[0] }}</td></tr>
                <tr><th>Unique Representatives</th><td>{{ data.vote_stats[1] }}</td></tr>
                <tr><th>Earliest Meeting</th><td>{{ data.vote_stats[2] or 'N/A' }}</td></tr>
                <tr><th>Latest Meeting</th><td>{{ data.vote_stats[3] or 'N/A' }}</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      {% if data.recent_docs %}
      <h4 style="font-size:.95rem;margin-bottom:.75rem;">
        <i class="fas fa-clock text-info me-1" aria-hidden="true"></i>Recently Processed Documents
      </h4>
      <div class="cc-table-wrapper">
        <table class="cc-table">
          <thead>
            <tr>
              <th>Document Title</th>
              <th>Meeting Date</th>
              <th>Document Type</th>
              <th>Processed At</th>
            </tr>
          </thead>
          <tbody>
            {% for doc in data.recent_docs %}
            <tr>
              <td>{{ doc[0] }}</td>
              <td>{{ doc[1] or '—' }}</td>
              <td>{{ doc[2] or '—' }}</td>
              <td>{{ doc[3] or '—' }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <p class="text-muted" style="font-size:.88rem;">No processed documents found.</p>
      {% endif %}
      {% endif %}
    </div>
  </div>
  {% endfor %}

  <!-- ── Data sources & methodology ────────────────────────────── -->
  <div class="cc-card mb-4">
    <div class="cc-card-header">
      <i class="fas fa-info-circle text-primary" aria-hidden="true"></i>
      <span>Data Sources &amp; Methodology</span>
    </div>
    <div class="cc-card-body">
      <div class="row g-4">
        <div class="col-md-6">
          <h5 style="font-size:.95rem;margin-bottom:.75rem;">Data Sources</h5>
          <ul style="font-size:.88rem;padding-left:1.2rem;color:var(--cc-text-muted);">
            <li class="mb-2"><strong style="color:var(--cc-text);">York County Council:</strong> Official meeting minutes and agendas from the York County government website</li>
            <li class="mb-2"><strong style="color:var(--cc-text);">Committee Minutes:</strong> Finance &amp; Operations, Transportation, Planning Commission, Board of Zoning Appeals</li>
            <li><strong style="color:var(--cc-text);">PDF Documents:</strong> All source documents are official government PDF files</li>
          </ul>
        </div>
        <div class="col-md-6">
          <h5 style="font-size:.95rem;margin-bottom:.75rem;">Processing Method</h5>
          <ul style="font-size:.88rem;padding-left:1.2rem;color:var(--cc-text-muted);">
            <li class="mb-2"><strong style="color:var(--cc-text);">Text Extraction:</strong> PDF content is extracted using PyMuPDF</li>
            <li class="mb-2"><strong style="color:var(--cc-text);">Voting Pattern Recognition:</strong> Automated parsing of voting records using pattern matching</li>
            <li class="mb-2"><strong style="color:var(--cc-text);">Representative Mapping:</strong> Names are mapped to districts using official council structure</li>
            <li><strong style="color:var(--cc-text);">Data Validation:</strong> Records are cross-referenced for accuracy</li>
          </ul>
        </div>
      </div>

      <h5 style="font-size:.95rem;margin-top:1.25rem;margin-bottom:.75rem;">District Assignments</h5>
      <div class="row g-2">
        <div class="col-md-6">
          <p style="font-size:.88rem;font-weight:600;margin-bottom:.4rem;">York County Council Districts</p>
          <ul class="list-unstyled" style="font-size:.85rem;color:var(--cc-text-muted);">
            <li>District 1: Joel Hamilton</li>
            <li>District 2: Albert Quarles</li>
            <li>District 3: Tom Audette</li>
            <li>District 4: Barbara Candler</li>
          </ul>
        </div>
        <div class="col-md-6">
          <ul class="list-unstyled" style="font-size:.85rem;color:var(--cc-text-muted);margin-top:1.4rem;">
            <li>District 5: Tommy Adkins</li>
            <li>District 6: Tony Smith</li>
            <li>District 7: Debi Cloninger</li>
            <li>At-Large: Allison Love, William "Bump" Roddey</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- ── Update cadence ────────────────────────────────────────── -->
  <div style="background:var(--cc-primary-light);border-radius:var(--cc-radius);padding:1.25rem 1.5rem;border-left:4px solid var(--cc-primary);">
    <h5 style="font-size:.95rem;margin-bottom:.4rem;">
      <i class="fas fa-sync-alt me-2 text-primary" aria-hidden="true"></i>How Data is Updated
    </h5>
    <p style="font-size:.88rem;color:var(--cc-text-muted);margin:0;">
      Data is processed from official government PDF documents. The system automatically
      extracts voting records, representative information, and meeting details.
      All data is sourced from publicly available government documents.
      <strong>Last Updated:</strong> Data processing runs regularly to include new documents as they become available.
    </p>
  </div>

</div><!-- /.cc-fade-in -->
{% endblock %}